apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: cert-manager

resources:
- https://github.com/cert-manager/cert-manager/releases/download/v1.19.1/cert-manager.yaml

patches:
# - target:
#     kind: ValidatingWebhookConfiguration
#     name: cert-manager-webhook
#   patch: |-
#     apiVersion: admissionregistration.k8s.io/v1
#     kind: ValidatingWebhookConfiguration
#     metadata:
#       name: cert-manager-webhook
#     webhooks:
#       - name: webhook.cert-manager.io
#         failurePolicy: Ignore
- target:
    kind: ClusterRole
    name: cert-manager-cainjector
  patch: |-
    - op: add
      path: /rules/-
      value:
        apiGroups:
        - coordination.k8s.io
        resources:
        - leases
        verbs:
        - get
        - list
        - watch
        - create
        - update
        - patch
        - delete
  options:
    allowKindChange: false
- target:
    kind: ClusterRole
    name: cert-manager-controller-certificates
  patch: |-
    - op: add
      path: /rules/-
      value:
        apiGroups:
        - coordination.k8s.io
        resources:
        - leases
        verbs:
        - get
        - list
        - watch
        - create
        - update
        - patch
        - delete
  options:
    allowKindChange: false

labels:
- pairs:
    app.kubernetes.io/name: cert-manager
    app.kubernetes.io/part-of: cert-manager

